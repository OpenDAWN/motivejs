!function(){function a(a){return 1===a||4===a||5===a?"P":"M"}function b(a,b,c,d){var e=[0,2,4,5,7,9,11],f=0,g=a.slice(0,1);switch(g){case"P":case"M":break;case"m":f-=1;break;case"A":f+=1;break;case"d":f-="M"===d?2:1}for(var h=0;h<a.slice(1).length;h++)"d"===a.slice(1)[h]?f-=1:"A"===a.slice(1)[h]&&(f+=1);return e[b-1]+f+12*c}function c(a,b){var c=["d","m","P","M","A"];return a.size<b.size?-1:a.size>b.size?1:c.indexOf(a.quality)<c.indexOf(b.quality)?-1:c.indexOf(a.quality)>c.indexOf(b.quality)?1:0}function d(a,b){var c=[];c.push(b);for(var d=1;d<a.length;d++)c.push(b.up(a[d]));return c}var e={},f={};f.modulo=function(a,b){return a>=0?a%b:(a%b+b)%b},f.mod7=function(a){return f.modulo(a,7)},f.mod12=function(a){return f.modulo(a,12)},f.Circle=function(a){return this.array=a,this.size=a.length,this},f.Circle.prototype.indexOf=function(a){return this.array.indexOf(a)},f.Circle.prototype.atIndex=function(a){return a=f.modulo(a,this.size),this.array[a]};var g={};g.steps=["C","D","E","F","G","A","B"],g.operators={b:-1,"#":1,x:2};var h={};h.mtof=function(a){return 440*Math.pow(2,(a-69)/12)},h.alterToAccidental=function(a){if("undefined"==typeof a)throw new Error("Cannot convert alter to accidental, none given.");if(0===a||null===a)return"";for(var b="";0>a;)b+="b",a+=1;for(;a>1;)b+="x",a+=-2;for(;a>0;)b+="#",a+=-1;return b},h.accidentalToAlter=function(a){if(!a)return 0;for(var b=0,c=0;c<a.length;c++)b+=g.operators[a[c]];return b};var i={};i.splitStringByPattern=function(a,b){for(var c=[];b.test(a);){var d=a.match(b);c.push(d[0]),a=a.slice(d[0].length)}return c},i.makeValidation=function(a,b,c){return function(d){if("string"!=typeof d)throw new TypeError("Cannot validate "+a+". Input must be a string.");var e=function(){return d.match(b)?!0:!1};return{valid:e(),parse:function(){if(!e())return!1;var a=b.exec(d);return c(a)}}}},i.validate={},i.validate.noteName=function(a){var b=/^([A-G])(b+|\#+|x+)?(\-?[0-9]+)?$/;return i.makeValidation("note",b,function(a){return{step:a[1],accidental:a[2]?a[2]:"",octave:a[3]?parseInt(a[3],10):null}})(a)},i.validate.abcNoteName=function(a){var b=/((?:\_|\=|\^)*)([a-g]|[A-G])((?:\,|\')*)/;return i.makeValidation("abc-note",b,function(a){return{accidental:a[1]?a[1]:"",step:a[2],adjustments:a[3]?a[3]:""}})(a)},i.validate.intervalName=function(a){var b=/^(P|M|m|A+|d+)(\d+|U)$/;return i.makeValidation("interval",b,function(a){return{quality:a[1],size:parseInt(a[2],10)}})(a)},i.validate.chordName=function(a){var b=/^/,c=/([A-G](?:b+|\#+|x+)?)/,d=/((?:maj|min|sus|aug|dim|mmaj|m|\-)?(?:\d+)?(?:\/\d+)?)?/,e=/((?:(?:add|sus)(?:\d+)|(?:sus|alt)|(?:\#|\+|b|\-)(?:\d+))*)/,f=/(\/)?/,g=/([A-G](?:b+|\#+|x+)?)?/,h=/$/,j=new RegExp(b.source+c.source+d.source+e.source+f.source+g.source+h.source);return i.makeValidation("chord",j,function(a){return{root:a[1],species:a[2]?a[2]:"",alterations:a[3]?a[3]:"",slash:a[4]?a[4]:"",bass:a[5]?a[5]:""}})(a)};var j={};j.fifths=new f.Circle(["F","C","G","D","A","E","B"]),j.fifths.indexOf=function(a){var b=a[0],c=a.slice(1),d=h.accidentalToAlter(c),e=this.array.indexOf(b);return e+=this.size*d},j.fifths.atIndex=function(a){var b=Math.floor(a/this.array.length),c=h.alterToAccidental(b);return a=f.modulo(a,this.size),this.array[a]+c},j.intervals=new f.Circle([4,1,5,2,6,3,7]),j.intervals.indexOf=function(a){var b=i.validate.intervalName(a).parse();if(!b)throw new Error("Invalid interval name.");var c=b.quality,d=b.size;d="U"===d?1:parseInt(d,10),d=7>=d?d:f.modulo(d,this.size);var e,g,h,j=this.array.indexOf(d)-1;return"P"===c||"M"===c?e=j:"m"===c?e=j-this.size:c.match(/A+/)?(g=c.match(/A+/)[0].length,e=j+this.size*g):c.match(/d+/)&&(h=c.match(/d+/)[0].length,e=1===d||4===d||5===d?j-this.size*h:j-(this.size+this.size*h)),e},j.intervals.atIndex=function(a){var b=a+1,c=Math.floor(b/this.size);b=f.modulo(b,this.size);var d=this.array[b].toString(10),e="";if(c>0)for(var g=0;c>g;g+=1)e+="A";else if(0===c)e=3>b?"P":"M";else if(-1===c)e=3>b?"d":"m";else if(-1>c){for(var h=-1;h>c;h-=1)e+="d";e+=3>b?"d":""}return e+d},j.pitchNames=new f.Circle(["C","C#","D","Eb","E","F","F#","G","Ab","A","Bb","B"]),j.pitchNames.indexOf=function(a){var b=i.validate.noteName(a).parse();if(!b)throw new Error("Invalid pitch name.");var c=h.accidentalToAlter(b.accidental),d=this.array.indexOf(b.step);return null===b.octave?f.mod12(d+c):d+c+this.size*(b.octave+1)},j.pitchNames.atIndex=function(a){var b=Math.floor(a/this.size)-1,c=f.mod12(a);return this.array[c]+b.toString(10)};var k={};k.transpose=function(a,b,c){if("up"!==b&&"down"!==b)throw new Error('Transpose direction must be either "up" or "down".');var d=i.validate.noteName(a).parse();if(!d)throw new Error("Invalid note name.");var e=i.validate.intervalName(c).parse();if(!e)throw new Error("Invalid interval name.");var f="up"===b?1:-1,h=j.fifths.atIndex(j.fifths.indexOf(d.step+d.accidental)+f*j.intervals.indexOf(c));if(null===d.octave)return h;var k=d.octave+f*Math.floor(e.size/8),l=e.size>7?e.size%7-1:e.size-1;return g.steps.indexOf(d.step)+l>=7&&(k+=f),h+k.toString(10)},k.toObject=function(a,b){if("string"==typeof a&&(a=b(a)),"object"!=typeof a)throw new TypeError("Input must be an object or string.");return a};var l={};l.abc={},l.abc.accidentals={_:-1,"=":0,"^":1},l.abc.adjustments={",":-1,"'":1},l.abc.abcToScientific=function(a){var b=i.validate.abcNoteName(a).parse();if(!b)throw new Error("Cannot convert ABC to scientific notation. Invalid ABC note name.");var c,d,e,f=0;e=/[A-G]/.test(b.step)?4:5;for(var g=0;g<b.accidental.length;g++)f+=l.abc.accidentals[b.accidental[g]];for(var j=0;j<b.adjustments.length;j++)e+=l.abc.adjustments[b.adjustments[j]];c=b.step.toUpperCase(),d=h.alterToAccidental(f);var k=c+d+e.toString(10);if(!i.validate.noteName(k).valid)throw new Error("Something went wrong converting ABC to scientific notation. Output invalid.");return k},l.abc.scientificToAbc=function(a){var b=i.validate.noteName(a).parse();if(!b||null===b.octave)throw new Error("Cannot convert scientific to ABC. Invalid scientific note name.");for(var c,d="",e="",f=h.accidentalToAlter(b.accidental);0>f;)d+="_",f+=1;for(;f>0;)d+="^",f-=1;var g=b.octave;if(g>=5)for(c=b.step.toLowerCase();g>5;g--)e+="'";else for(c=b.step.toUpperCase();4>g;g++)e+=",";var j=d+c+e;if(!i.validate.abcNoteName(j).valid)throw new Error("Something went wrong converting scientific to ABC. Output invalid.");return j};var m=function(a){var b;if("string"==typeof a)b=a;else{if("number"!=typeof a)throw new TypeError("Note name must be a string or number.");b=j.pitchNames.atIndex(a)}var c=i.validate.noteName(b).parse();if(!c)throw new Error("Invalid note name.");return this.name=b,this.type="note",this.pitchClass=j.pitchNames.indexOf(c.step+c.accidental),this.parts={step:c.step,accidental:c.accidental},null!==c.octave&&this.setOctave(c.octave),this},n=function(a){return"string"==typeof a?new m(a):a};m.prototype.setOctave=function(a){if("number"!=typeof a)throw new TypeError("Octave must be a number.");this.name=this.parts.step+this.parts.accidental,this.type="pitch",this.octave=a,this.scientific=this.name+a.toString(10),this.abc=l.abc.scientificToAbc(this.scientific),this.midi=j.pitchNames.indexOf(this.scientific),this.frequency=h.mtof(this.midi)},m.prototype.isEquivalent=function(a){return a=n(a),this.name!==a.name?!1:"pitch"===this.type&&"pitch"===a.type&&this.octave!==a.octave?!1:!0},m.prototype.isEnharmonic=function(a){return a=n(a),this.pitchClass!==a.pitchClass?!1:"pitch"===this.type&&"pitch"===a.type&&Math.abs(this.midi-a.midi)>11?!1:!0},m.prototype.transpose=function(a,b){return new m(k.transpose("pitch"===this.type?this.scientific:this.name,a,b))},m.prototype.intervalTo=function(a){return a=n(a),j.intervals.atIndex(j.fifths.indexOf(a.name)-j.fifths.indexOf(this.name))},m.prototype.intervalFrom=function(a){return a=n(a),j.intervals.atIndex(j.fifths.indexOf(this.name)-j.fifths.indexOf(a.name))},m.prototype.up=function(a){return this.transpose("up",a)},m.prototype.down=function(a){return this.transpose("down",a)},m.prototype.toString=function(){var a;return"note"===this.type?a=this.name:"pitch"===this.type&&(a=this.scientific),"[note "+a+"]"};var o=function(a){var b=l.abc.abcToScientific(a);return new m(b)},p=function(c){var d=i.validate.intervalName(c).parse();if(!d)throw new Error("Invalid interval name.");this.steps=d.size-1;var e=d.size>7?this.steps%7+1:d.size;return this.name=c,this.type="interval",this.quality=d.quality,this.size=d.size,this.normalized=this.quality+e.toString(10),this.species=a(e),this.octaves=Math.floor(this.size/7.001),this.semitones=b(this.quality,e,this.octaves,this.species),this},q={};q.ParsedIntervalArray=function(a){this.array=[];for(var b=0;b<a.length;b++)this.array.push("R"===a[b]?{quality:"P",size:1}:i.validate.intervalName(a[b]).parse())},q.ParsedIntervalArray.prototype.sort=function(){return this.array.sort(c)},q.ParsedIntervalArray.prototype.add=function(a){for(var b=i.validate.intervalName(a).parse(),c=0;c<this.array.length;c++)if(this.array[c].size===b.size&&this.array[c].quality===b.quality)return;this.array.push(b),this.sort()},q.ParsedIntervalArray.prototype.remove=function(a){for(var b=7>=a?a+7:a-7,c=[],d=0;d<this.array.length;d++)this.array[d].size!==a&&this.array[d].size!==b&&c.push(this.array[d]);this.array=c},q.ParsedIntervalArray.prototype.update=function(a){var b=i.validate.intervalName(a).parse();this.remove(b.size),this.array.push(b),this.sort()},q.ParsedIntervalArray.prototype.unparse=function(){this.sort();for(var a=[],b=0;b<this.array.length;b++){var c=this.array[b].quality+this.array[b].size;a.push("P1"===c?"R":c)}return a},q.applyAlterations=function(){function a(a){var b=8>a?a:a%7;return 1===b||4===b||5===b?"P"+a.toString(10):"M"+a.toString(10)}var b=/^(?:(?:add|sus|no)(?:\d+)|(?:sus|alt)|(?:n|b|\#|\+|\-)(?:\d+))/,c=function(a){var b=/(?:n|b|\#|\+|\-)(?:\d+)/;if(!b.test(a))return!1;var c=a.slice(0,1),d=a.slice(1);return"+"===c&&(c="#"),"-"===c&&(c="b"),"#"===c?"A"+d:"b"===c?"5"===d||"11"===d||"4"===d?"d"+d:"m"+d:"n"===c?"5"===d||"11"===d||"4"===d?"P"+d:"M"+d:void 0},d=function(a){return/sus/.test(a)?"susX":/add/.test(a)?"addX":/no/.test(a)?"noX":/alt/.test(a)?"alt":"binary"};return function(e,f){for(var g=new q.ParsedIntervalArray(e),h=i.splitStringByPattern(f,b),j=0;j<h.length;j++){var k=h[j];switch(d(k)){case"binary":var l=c(k);g.update(l);break;case"susX":g.remove(3),g.add("P4");break;case"addX":var m=parseInt(k.slice(3),10);g.add(a(m));break;case"noX":var n=parseInt(k.slice(2),10);g.remove(n);break;case"alt":g.update("d5"),g.add("A5"),g.update("m9"),g.add("A9"),g.update("m13")}}return g.unparse()}}();var r=function(){var a={five:["R","P5"],maj:["R","M3","P5"],min:["R","m3","P5"],aug:["R","M3","A5"],dim:["R","m3","d5"],sus2:["R","M2","P5"],sus4:["R","P4","P5"]},b={nine:["M9"],eleven:["M9","P11"],thirteen:["M9","P11","M13"]},c=/^(maj|min|mmin|m|aug|dim|alt|sus|\-)?((?:\d+)|(?:6\/9))?$/;return function(d){if(d in a)return a[d];if(""===d)return a.maj;if("5"===d)return a.five;if("m"===d||"-"===d)return a.min;if("sus"===d)return a.sus4;var e=[],f=c.exec(d),g=f[1]?f[1]:"",h=f[2]?f[2]:"";switch(g){case"":e="6/9"===h?e.concat(a.maj,["M6","M9"]):e.concat(a.maj,"6"===h?"M6":"m7");break;case"maj":e=e.concat(a.maj,"6"===h?"M6":"M7");break;case"min":case"m":case"-":e=e.concat(a.min,"6"===h?"M6":"m7");break;case"aug":e=e.concat(a.aug,"6"===h?"M6":"m7");break;case"dim":e=e.concat(a.dim,"d7");break;case"mmaj":e=e.concat(a.min,"M7")}switch(h){case"9":e=e.concat(b.nine);break;case"11":e=e.concat(b.eleven);break;case"13":e=e.concat(b.thirteen)}return e}}(),s=function(a){var b=i.validate.chordName(a).parse();if(!b)throw new Error("Invalid chord name.");var c=r(b.species),e=q.applyAlterations(c,b.alterations);this.name=a,this.type="chord",this.root=new m(b.root),this.formula=b.species+b.alterations,this.isSlash="/"===b.slash?!0:!1,this.bass=this.isSlash?new m(b.bass):this.root,this.intervals=e,this.notes=d(this.intervals,this.root)};s.prototype.transpose=function(a,b){return new s(k.transpose(this.root,a,b).name+this.formula)},s.prototype.toString=function(){return"[chord "+this.name+"]"},e.abc=o,e.note=function(a){return new m(a)},e.chord=function(a){return new s(a)},e.interval=function(a){return new p(a)},e.constructors={Note:m,Interval:p,Chord:s},"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e:this.motive=e}();